<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Mauro Trevisan">
	<link rel="shortcut icon" href="../favicon.png" />

	<title>test Multidimensional Scaling</title>

	<script src="../app/AMDLoader.js"></script>

	<script>
		AMDLoader.config = {
			baseUrl: '../app',
			paths: {
				libs: '../libs'
			}
		};


		//http://www.bristol.ac.uk/media-library/sites/cmm/migrated/documents/chapter3.pdf
		//https://homepage.uni-tuebingen.de/florian.wickelmaier/pubs/Wickelmaier2003SQRU.pdf
		//https://github.com/asarnow/mdscale/blob/master/src/main/java/mdscale/Data.java
		require(['../test/lib/EVDecomposition'], function(EVDecomposition){
			var doubleCenter = function(J, P2, n){
				var c = [],
					d = [],
					i, j, k,
					sum0, sum1;
				for(i = 0; i < n; i ++){
					d[i] = [];
					for(j = 0; j < n; j ++){
						sum0 = 0;
						for(k = 0; k < n; k ++)
							sum0 += J[Math.min(i, k)][Math.max(k, i)] * P2[Math.min(k, j)][Math.max(j, k)];
						c[j] = sum0;
					}
					for(j = i; j < n; j ++){
						sum1 = 0;
						for(k = 0; k < n; k ++)
							sum1 += c[k] * J[Math.min(k, j)][Math.max(j, k)];
						d[i][j] = -0.5 * sum1;
					}
				}
				return d;
			};

			var multiplyDiagonal = function(a, b, n, m){
				var c = [],
					i, j;
				for(i = 0; i < n; i ++){
					c[i] = [];
					for(j = 0; j < m; j ++)
						c[i][j] = a[i][j] * b[j];
				}
				return c;
			};


			var dimensions = 2,
				variants = ['Anpeŧ', 'Pàđule', 'Uronŧo', 'Poŧale', 'Verona', 'Ŧenŧenige', 'Kaxan', 'Arfanta (Tarŧo)', 'Belun', 'Sa Stin', 'Venèsia', 'Krespaòro', 'Bixa', 'Montebèlo', 'Teoƚo', 'Roman', 'Vas', 'Toneđa', 'Vicensa', 'Lovadina', 'Kanpo San Martin', 'Istrana', 'Raldon', 'Méolo', 'Cerèa', 'Frata', 'Vila', 'Kavàrxare', 'Trevixo', 'Italia'],
				matrix = [[0,0.2738243222618224,0.15931663119163128,0.1951716311091311,0.252763520732271,0.24748328342078352,0.2653220442282943,0.2653775255337757,0.26175383831633864,0.2599907342094844,0.2653338004900507,0.25641940876315894,0.2671752023314524,0.25720553142428154,0.27395841067716076,0.25833820599445617,0.2597773683711186,0.2596409854222356,0.25782861329736345,0.26283868861993887,0.2631576545639047,0.2606549629987132,0.23957660442035464,0.24917172495297518,0.2321672204484706,0.2743352298039799,0.2724144731957233,0.2739587200524703,0.24326528623403654,0.35554382741882745],[null,0,0.20531426859551888,0.23583099754974776,0.3142099688974692,0.26732367669867707,0.29202827484077504,0.3071367211992216,0.29247426513051555,0.3002599783849787,0.3126056001056004,0.30552827896577933,0.3201057857307861,0.307339052651553,0.3223213770088773,0.3165769478269482,0.29147727741477775,0.3075106012606017,0.3079940142440145,0.3106806669306673,0.3191665222915227,0.31094183125433167,0.30635348604098633,0.2997510044385047,0.2970061751311755,0.314752561627562,0.31777850996601037,0.31997368247368296,0.29866839710589743,0.39272419819294846],[null,null,0,0.13311347061347065,0.21180728290103312,0.20847938426063448,0.21154364357489358,0.22101228116853128,0.2128753238128239,0.2094653633716135,0.21466673576048598,0.20643627440502463,0.2335077952265455,0.21099500396375406,0.2301025386962889,0.21134002305877322,0.2067816872504373,0.2076178490240992,0.20707760942135955,0.21794611403986422,0.22014395842520856,0.21041452682077708,0.2059051754364257,0.2034526542339045,0.19243961509586524,0.22849813240438266,0.22112556409431433,0.22849801990427013,0.2024283125845628,0.3207127402439904],[null,null,null,0,0.25920136310761316,0.22262180621555644,0.22759702525327521,0.25400287822162837,0.22280560093060114,0.25606744278619276,0.26935036856911876,0.2580305322492823,0.27101460148335155,0.26091267263142276,0.285102985884236,0.26503277831402844,0.23115783193908204,0.26659960956835954,0.26242271945396944,0.2594442742880243,0.2769546589859091,0.2630660794723297,0.25318788053163066,0.25615876006501015,0.2461562438124939,0.2745444190756691,0.2719911446473948,0.280499171905422,0.2460889031201532,0.36338850948225965],[null,null,null,null,0,0.22370513542388562,0.16182654151404166,0.14605685699435708,0.16941239831864843,0.12909241659241663,0.12094308422433418,0.09588213025713019,0.1279491201366202,0.09838970151470144,0.12655925155925155,0.10657762845262843,0.16104949386199402,0.0987962839525339,0.09527575465075455,0.13417235917235926,0.12599361505611503,0.11296189733689732,0.05904334966834967,0.1049079299079299,0.054476351351351336,0.1277909262284262,0.12359698297198293,0.1372290434790435,0.10874341030591025,0.25645433067308104],[null,null,null,null,null,0,0.15930332805332814,0.16639529295779304,0.1356212410899911,0.19722557378807395,0.24349837474837507,0.22907184782184808,0.19759973744348758,0.22940373721623752,0.251866034678535,0.22707325285450305,0.14245882214632213,0.22854984729984762,0.2300852066477069,0.194236698924199,0.24588509276009313,0.23461497211497243,0.21925167784542804,0.22237778644028666,0.21483294764544783,0.24872753935253972,0.2422947501072504,0.2558544027294031,0.22304804804804815,0.3553450022200024],[null,null,null,null,null,null,0,0.08558207933207929,0.07766106594231592,0.13056963213213219,0.17641425766425783,0.16644797582297602,0.1543365652740654,0.16701707170457183,0.19062477968727987,0.15977497071247085,0.06593463312213309,0.16447345119220128,0.16968968062718076,0.12858560827310825,0.1827451311826313,0.1653378481503483,0.16102371258621268,0.15503688784938796,0.147062068937069,0.19666374822624844,0.18143294393294418,0.19666578260328285,0.1528811606936608,0.3026836901836904],[null,null,null,null,null,null,null,0,0.08236238470613466,0.09391644391644391,0.15471658127908133,0.15974864099864114,0.1542242104742107,0.15570998539748554,0.1618614493614495,0.13467555811305815,0.07735310860310858,0.15944884929259945,0.15996783340533358,0.08533158845658843,0.15807908307908317,0.13370025245025247,0.14952247920997924,0.12629040441540443,0.1389484951984953,0.16403805935055946,0.16471218814968827,0.16491132741132755,0.13701103232353237,0.29074244777369795],[null,null,null,null,null,null,null,null,0,0.136318108974359,0.1914526562964064,0.1799575963638465,0.1583168075355576,0.1795004240316742,0.19649538946413966,0.16651762511137516,0.07294804247929247,0.18022674585174603,0.18227620961995986,0.12678084162459158,0.19252028236403254,0.17200563372438382,0.17284213299838308,0.16321813743688748,0.15752171299046305,0.1944376124063626,0.19105588246213268,0.2035365183802686,0.1606169098356599,0.32265213905838924],[null,null,null,null,null,null,null,null,null,0,0.10646965646965642,0.12472906457281456,0.1514280764280764,0.1243569563882064,0.11881851959976962,0.09986279205029198,0.12412261162261162,0.1332101035226036,0.1259851142663643,0.04991492178992178,0.10952303608553601,0.08982629607629604,0.12763881670131672,0.06553259990759988,0.11287620037620036,0.1246297293172293,0.12764987686862683,0.12467469186219189,0.09810229185229183,0.2653605473917976],[null,null,null,null,null,null,null,null,null,null,0,0.10254259394884391,0.18140940562815572,0.10073979370854365,0.08515903437778431,0.08138372747747745,0.16872416716166724,0.09768291955791954,0.09814559736434733,0.11638931170181173,0.07578880860130856,0.05580821205821206,0.12241957788832784,0.06716012028512024,0.10547926876051872,0.10091760716760709,0.10090267980892978,0.0925345206595206,0.07753223690723683,0.24137259371634398],[null,null,null,null,null,null,null,null,null,null,null,0,0.1528335684585685,0.03823430229680229,0.08273948742698739,0.08836924618174613,0.1573003291753293,0.052723662879912855,0.034663492475992465,0.12309646997147002,0.07813477110352106,0.09052190067815062,0.09319606350856345,0.08830883596508593,0.07906534625284622,0.09535782348282344,0.07090224668349664,0.09393255721380718,0.10468781640656634,0.2337857806607811],[null,null,null,null,null,null,null,null,null,null,null,null,0,0.1551792520542521,0.18558775121275142,0.1620998230373231,0.14466709154209162,0.16197970807345818,0.15569914319914324,0.1541307791307791,0.18433787496287507,0.17554032397782404,0.10991377710127706,0.1651540792165793,0.11582207207207204,0.18451581732831746,0.1800678253803255,0.19953949485199504,0.16149514899514897,0.31631185068685097],[null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.07095089595089593,0.08871706840456839,0.15917251386001402,0.047260404291654276,0.0182021807021807,0.12706692237942235,0.0767472744035244,0.08923433689058684,0.09347264503514498,0.08642082157707154,0.07898630086130085,0.09099321286821282,0.056948878823878814,0.08681341884466882,0.0973089902777402,0.23010870042120068],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.08198877417627409,0.17708735521235539,0.08057208135333131,0.0690501784251784,0.11767583486333487,0.04605848121473122,0.0640573742136242,0.11961795243045235,0.07167382870507866,0.10337435649935642,0.06923391923391917,0.06069262944262941,0.05800098690723685,0.09180118164493158,0.24036320286320323],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.1468333890208891,0.08601229148104145,0.08037625381375381,0.09419859419859414,0.05861091329841327,0.06278694559944559,0.10080824299574297,0.061540317790317774,0.08757904539154537,0.0966968513843513,0.09392495173745166,0.10128397784647779,0.07524363305613302,0.26196960415710446],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.16478264837639858,0.1633332180207182,0.1167044104544104,0.16810000247500262,0.15249820562320573,0.1559334574959576,0.14406638781638792,0.14585571148071153,0.18059474309474324,0.17734800391050412,0.18887733887733912,0.15473638129888137,0.30549874299874324],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.04014066592191592,0.1375104414166915,0.07165750915750914,0.09059830934830929,0.10071798274923266,0.09457231957231954,0.08760016025641024,0.10395945552195544,0.06640362030987026,0.09313124938124935,0.10165067196317187,0.23598639301764332],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.12653350309600314,0.06690587706212704,0.08708969099594097,0.09559355340605336,0.08788855429480424,0.08239699489699488,0.09294268513018508,0.055610521235521224,0.08692864708489705,0.09618742040617037,0.233667247729748],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10343753937503933,0.08046233046233045,0.12421001014751012,0.06727025789525788,0.1199358355608356,0.1254451910701911,0.1285550316800317,0.12422756016506019,0.09381373131373129,0.27720107876357913],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.0501379813879814,0.11298587392337388,0.0624122405372405,0.10399496336996335,0.07537382849882843,0.06795297185922179,0.06558725621225618,0.08017669267669263,0.24694090865965898],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10778047965547959,0.03685191028941028,0.09508526383526378,0.08178408490908484,0.08036356239481238,0.07445735570735565,0.0568413709038709,0.24453030781155816],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.09849499224499221,0.05231165231165229,0.12862933331683335,0.1156447484572484,0.13330131298881298,0.09898493960993957,0.26325223200223236],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.08330064267564263,0.08411419661419654,0.08929234007359003,0.08028639903639899,0.05812543312543313,0.24700046340671378],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10754365285615279,0.10568858693858689,0.11976011038511032,0.08704985892485886,0.2483321436446439],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.07431736337986335,0.06786033973533968,0.09820201382701375,0.2593547734172737],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.06497956576081575,0.09304160788535784,0.24189115595365626],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.09773296804546797,0.24498459967210004],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.26527984262359294],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0]],
				n = variants.length,
				i, j;

			//matrix of squared proximities: P2 = matrix^2
			var P2 = [];
			for(i = 0; i < n; i ++){
				P2[i] = [];
				for(j = i; j < n; j ++)
					P2[i][j] = Math.pow(matrix[i][j], 2);
			}
			//J = I - 1 * 1' / n
			var J = [],
				n_inv = 1 / n;
			for(i = 0; i < n; i ++){
				J[i] = [];
				for(j = i; j < n; j ++)
					J[i][j] = (i == j? 1: 0) - n_inv;
			}
			//apply the double centering: B = -0.5 * J * P2 * J
			var B = doubleCenter(J, P2, n);
			//extract the m = dimensions largest positive eigenvalues lambda_1..lambda_m of B and the corresponding eigenvectors e_1..e_m
			var eigen = EVDecomposition.decompose(B);
			var sorter = [];
			for(i = 0; i < n; i ++)
				sorter.push(i);
			sorter.sort(function(a, b){
				return (eigen.eigenvalues_real[b] - eigen.eigenvalues_real[a]);
			});
			var lambda = [],
				E = [];
			for(i = 0; i < n; i ++)
				E[i] = [];
			for(i = 0; i < dimensions; i ++){
				lambda.push(eigen.eigenvalues_real[sorter[i]]);
				for(j = 0; j < n; j ++)
					E[j][i] = eigen.eigenvectors[j][sorter[i]];
			}
			//a m-dimensional spatial configuration of the n objects is derived from the coordinate matrix X = E_m * Λ_m^0.5,
			//where E_m is the matrix of m eigenvectors and Λ_m is the diagonal matrix of m eigenvalues of B
			lambda = lambda.map(function(el){ return Math.sqrt(el); });
			var X = multiplyDiagonal(E, lambda, n, dimensions);

//console.log(JSON.stringify(B));
//console.log(JSON.stringify(eigen));
//console.log(JSON.stringify(lambda));
//console.log(JSON.stringify(E));
console.log(JSON.stringify(X));
		});

	</script>
</head>

<body>
</body>
</html>
