<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Mauro Trevisan">
	<link rel="shortcut icon" href="../favicon.png" />

	<title>test Multidimensional Scaling</title>

	<script src="../app/AMDLoader.js"></script>

	<script>
		AMDLoader.config = {
			baseUrl: '../app',
			paths: {
				libs: '../libs'
			}
		};


		//http://www.bristol.ac.uk/media-library/sites/cmm/migrated/documents/chapter3.pdf
		//https://homepage.uni-tuebingen.de/florian.wickelmaier/pubs/Wickelmaier2003SQRU.pdf
		//https://github.com/asarnow/mdscale/blob/master/src/main/java/mdscale/Data.java
		require(['../test/lib/EVDecomposition'], function(EVDecomposition){
			var doubleCenter = function(J, P2, n){
				var c = [],
					d = [],
					i, j, k,
					sum0, sum1;
				for(i = 0; i < n; i ++){
					d[i] = [];
					for(j = 0; j < n; j ++){
						sum0 = 0;
						for(k = 0; k < n; k ++)
							sum0 += J[Math.min(i, k)][Math.max(k, i)] * P2[Math.min(k, j)][Math.max(j, k)];
						c[j] = sum0;
					}
					for(j = i; j < n; j ++){
						sum1 = 0;
						for(k = 0; k < n; k ++)
							sum1 += c[k] * J[Math.min(k, j)][Math.max(j, k)];
						d[i][j] = -0.5 * sum1;
					}
				}
				return d;
			};

			var multiplyDiagonal = function(a, b, n, m){
				var c = [],
					i, j;
				for(i = 0; i < n; i ++){
					c[i] = [];
					for(j = 0; j < m; j ++)
						c[i][j] = a[i][j] * b[j];
				}
				return c;
			};


			var dimensions = 2,
				variants = ['Anpeŧ', 'Pàđule', 'Uronŧo', 'Poŧale', 'Verona', 'Ŧenŧenige', 'Kaxan', 'Arfanta (Tarŧo)', 'Belun', 'Sa Stin', 'Venèsia', 'Krespaòro', 'Bixa', 'Montebèlo', 'Teoƚo', 'Roman', 'Vas', 'Toneđa', 'Vicensa', 'Lovadina', 'Kanpo San Martin', 'Istrana', 'Raldon', 'Méolo', 'Cerèa', 'Frata', 'Vila', 'Kavàrxare', 'Trevixo', 'Italia'],
				matrix = [[0,0.2738243222618224,0.15931663119163128,0.1951716311091311,0.252763520732271,0.24748328342078352,0.2653220442282943,0.2653775255337757,0.26175383831633864,0.26008602180477197,0.2657681634244137,0.25641940876315894,0.2671752023314524,0.25720553142428154,0.2741805421492923,0.25844122797247815,0.2597773683711186,0.25966697294822316,0.25782861329736345,0.2629166511979014,0.2633667922730424,0.26075674747549776,0.23957660442035464,0.24924535627660654,0.2321672204484706,0.27447382994258007,0.2726625921938423,0.2742284953222456,0.24360776470151502,0.35554382741882745],[null,0,0.20531426859551888,0.23583099754974776,0.3142099688974692,0.26732367669867707,0.29202827484077504,0.3071367211992216,0.29247426513051555,0.3003725909975913,0.3130659505659507,0.30552827896577933,0.3201057857307861,0.307339052651553,0.32249153342903375,0.31667130729630766,0.29147727741477775,0.3075106012606017,0.3079940142440145,0.3107759545259549,0.3193410099660104,0.31104361573111616,0.30635348604098633,0.2998419607794611,0.2970061751311755,0.31483918671418704,0.31797465391215435,0.3202088077088082,0.29902386933636954,0.39272419819294846],[null,null,0,0.13311347061347065,0.21180728290103312,0.20847938426063448,0.21154364357489358,0.22101228116853128,0.2128753238128239,0.20957797598422614,0.21512058933933959,0.20643627440502463,0.2335077952265455,0.21099500396375406,0.23032467016842037,0.21147893257268272,0.2067816872504373,0.2076438365500867,0.20707760942135955,0.21805996415371434,0.2203889836702338,0.2105348738161241,0.2059051754364257,0.2035436105748608,0.19243961509586524,0.2286367325429828,0.22137368309243333,0.22878512019137046,0.20280667858792883,0.3207127402439904],[null,null,null,0,0.25920136310761316,0.22262180621555644,0.22759702525327521,0.25400287822162837,0.22280560093060114,0.2561800553988054,0.26980422214797234,0.2580305322492823,0.27101460148335155,0.26091267263142276,0.28531862047487055,0.26516828469953485,0.23115783193908204,0.2666255970943471,0.26242271945396944,0.2595612181549682,0.2771962811025312,0.26318952022077047,0.25318788053163066,0.25624971640596655,0.2461562438124939,0.2746765223327724,0.272232766764017,0.2807797753110254,0.24647036287661298,0.36338850948225965],[null,null,null,null,0,0.22370513542388562,0.16182654151404166,0.14605685699435708,0.16941239831864843,0.12918337293337295,0.12141426282051279,0.09588213025713019,0.1279491201366202,0.09838970151470144,0.126781383031383,0.10671963171963168,0.16104949386199402,0.09882227147852142,0.09527575465075455,0.13428930303930314,0.12624173405423406,0.11308533808533805,0.05904334966834967,0.10499888624888623,0.054476351351351336,0.12792952636702634,0.12384510197010193,0.13751614376614374,0.10912487006237001,0.25645433067308104],[null,null,null,null,null,0,0.15930332805332814,0.16639529295779304,0.1356212410899911,0.19733818640068657,0.2439587252087256,0.22907184782184808,0.19759973744348758,0.22940373721623752,0.2520881661506665,0.2272152561215063,0.14245882214632213,0.22857583482583516,0.2300852066477069,0.19435364279114287,0.24613321175821212,0.23473841286341315,0.21925167784542804,0.22246874278124296,0.21483294764544783,0.24886613949113986,0.2425428691053694,0.25614150301650335,0.22342517655017669,0.3553450022200024],[null,null,null,null,null,null,0,0.08558207933207929,0.07766106594231592,0.13068224474474482,0.17688543626043646,0.16644797582297602,0.1543365652740654,0.16701707170457183,0.19084041427791448,0.1599104770979772,0.06593463312213309,0.16449943871818878,0.16968968062718076,0.12870255214005213,0.18298675329925343,0.16546128889878906,0.16102371258621268,0.15512784419034426,0.147062068937069,0.19679585148335169,0.1816745660495663,0.19694638600888623,0.1532626204501206,0.3026836901836904],[null,null,null,null,null,null,null,0,0.08236238470613466,0.09398574398574397,0.15518775987525993,0.15974864099864114,0.1542242104742107,0.15570998539748554,0.1620770839520841,0.13481106449856453,0.07735310860310858,0.15947483681858696,0.15996783340533358,0.08544420106920103,0.15831637394137404,0.13382369319869322,0.14952247920997924,0.12638136075636075,0.1389484951984953,0.16417016260766273,0.16489843208593224,0.16519193081693098,0.1373739295614296,0.29074244777369795],[null,null,null,null,null,null,null,null,0,0.13643072158697162,0.19192383489258502,0.1799575963638465,0.1583168075355576,0.1795004240316742,0.19671102405477425,0.16663147522522526,0.07294804247929247,0.18025273337773354,0.18227620961995986,0.12687612921987917,0.19274024820899838,0.1721074182011683,0.17284213299838308,0.1633090937778438,0.15752171299046305,0.19456971566346584,0.1912975045787548,0.203817121785872,0.16097671332046337,0.32265213905838924],[null,null,null,null,null,null,null,null,null,0,0.10680656618156611,0.1248362631175131,0.15154068904068901,0.12446647524772528,0.11898651039276041,0.09990734209484202,0.12423522423522422,0.13334870366120372,0.1260977268789769,0.04989326551826551,0.10966937060687054,0.09035378097878095,0.12772977304227306,0.06596263158763156,0.11298571923571923,0.12480081386331386,0.1278534458221958,0.12479937011187014,0.0987176393426393,0.2654646521834024],[null,null,null,null,null,null,null,null,null,null,0,0.10300712097587092,0.18188058422433434,0.10120432073557066,0.08542122995247989,0.08171754343629341,0.16919534575784587,0.09814744658494656,0.09861012439137434,0.11672622141372141,0.07608580889830886,0.05613429363429363,0.12282145641520638,0.06747537372537367,0.10595044735669733,0.10128267003266996,0.10126542235917234,0.09280754437004432,0.0778007746757746,0.2417910238222741],[null,null,null,null,null,null,null,null,null,null,null,0,0.1528335684585685,0.03823430229680229,0.08296161889911886,0.08851124944874939,0.1573003291753293,0.05274965040590038,0.034663492475992465,0.12321341383841387,0.07838289010164004,0.09064534142659135,0.09319606350856345,0.08839979230604225,0.07906534625284622,0.09549642362142358,0.07115036568161563,0.09421965750090747,0.10506695584820576,0.2337857806607811],[null,null,null,null,null,null,null,null,null,null,null,null,0,0.1551792520542521,0.18580988268488285,0.16224182630432635,0.14466709154209162,0.1620056955994457,0.15569914319914324,0.15424772299772296,0.18458599396099407,0.17566376472626483,0.10991377710127706,0.16524503555753564,0.11582207207207204,0.18465441746691758,0.1803159443784445,0.19982659513909531,0.16187660875160875,0.31631185068685097],[null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.07117302742302739,0.08885907167157163,0.15917251386001402,0.047286391817641805,0.0182021807021807,0.12718386624636624,0.07699539340164338,0.08935777763902758,0.09347264503514498,0.08651177791802787,0.07898630086130085,0.09113181300681297,0.057196997821997816,0.0871005191317691,0.09768812971937962,0.23010870042120068],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.08213387119637111,0.17730948668448684,0.08076822529947526,0.06927230989730987,0.1178394944019944,0.04609746250371251,0.06412791178416176,0.119775115087615,0.07182016322641317,0.1035964879714879,0.0693174505674505,0.06075017325017322,0.058022643178893135,0.09210885539010531,0.24046529671529712],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.14697539228789236,0.08618028227403222,0.08051825708075705,0.09422148797148791,0.0586693852318852,0.06290729259479258,0.10095024626274623,0.06158486783486781,0.08771795490545489,0.09686051092301083,0.09406695500445493,0.10136410605160598,0.0754518426393426,0.26205313549063586],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.16480863590238612,0.1633332180207182,0.11682135432135428,0.16834812147312164,0.1526216463716465,0.1559334574959576,0.14415734415734427,0.14585571148071153,0.18073334323334336,0.1775961229086231,0.18916443916443937,0.15511784105534113,0.30549874299874324],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.04016665344790343,0.13765337280962292,0.0718796406296406,0.09074773762273755,0.1007439702752202,0.0946892634392634,0.08762614778239777,0.10407206813456803,0.06662575178200174,0.0933923621423621,0.10205579893079883,0.23596040549165578],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.126650446962947,0.06715399606024602,0.08721313174438171,0.09559355340605336,0.08797951063576058,0.08239699489699488,0.0930812852687852,0.05585864023364022,0.08721574737199733,0.09656655984780979,0.233667247729748],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10356221762471757,0.08055978368478367,0.12432695401445401,0.06729191416691414,0.12004968567468573,0.1255902880902881,0.12872611622611627,0.12437389468639472,0.09399904712404708,0.27731059762309795],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.05025183150183151,0.11323399292149286,0.06255857505857501,0.10423998861498858,0.07543137230637222,0.06803650319275313,0.06560891248391246,0.0804433741933741,0.24706156503031537],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10790392040392033,0.03697101978351978,0.09520561083061076,0.08185771623271616,0.08043719371844368,0.07459286209286202,0.0570808273933274,0.24464106417231454],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.09858594858594855,0.05231165231165229,0.12876793345543347,0.11589286745536741,0.13352344446094444,0.09930143055143048,0.26325223200223236],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.08339159901659898,0.08426362488862481,0.0894417683480183,0.08041107728607723,0.05833240520740521,0.24708832599457634],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.10768225299475291,0.1059367059367059,0.12004721067221061,0.08742822492822486,0.2483321436446439],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.07429137585387582,0.06798718361218356,0.09858007045507036,0.2593733359358362],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.06510640963765962,0.09341734419859414,0.24199881856131888],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.09801898551898543,0.245148568586069],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,0.26564629767754805],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0]],
				n = variants.length,
				i, j;

			//matrix of squared proximities: P2 = matrix^2
			var P2 = [];
			for(i = 0; i < n; i ++){
				P2[i] = [];
				for(j = i; j < n; j ++)
					P2[i][j] = Math.pow(matrix[i][j], 2);
			}
			//J = I - 1 * 1' / n
			var J = [],
				n_inv = 1 / n;
			for(i = 0; i < n; i ++){
				J[i] = [];
				for(j = i; j < n; j ++)
					J[i][j] = (i == j? 1: 0) - n_inv;
			}
			//apply the double centering: B = -0.5 * J * P2 * J
			var B = doubleCenter(J, P2, n);
			//extract the m = dimensions largest positive eigenvalues lambda_1..lambda_m of B and the corresponding eigenvectors e_1..e_m
			var eigen = EVDecomposition.decompose(B);
			var sorter = [];
			for(i = 0; i < n; i ++)
				sorter.push(i);
			sorter.sort(function(a, b){
				return (eigen.eigenvalues_real[b] - eigen.eigenvalues_real[a]);
			});
			var lambda = [],
				E = [];
			for(i = 0; i < n; i ++)
				E[i] = [];
			for(i = 0; i < dimensions; i ++){
				lambda.push(eigen.eigenvalues_real[sorter[i]]);
				for(j = 0; j < n; j ++)
					E[j][i] = eigen.eigenvectors[j][sorter[i]];
			}
			//a m-dimensional spatial configuration of the n objects is derived from the coordinate matrix X = E_m * Λ_m^0.5,
			//where E_m is the matrix of m eigenvectors and Λ_m is the diagonal matrix of m eigenvalues of B
			lambda = lambda.map(function(el){ return Math.sqrt(el); });
			var X = multiplyDiagonal(E, lambda, n, dimensions);

//console.log(JSON.stringify(B));
//console.log(JSON.stringify(eigen));
//console.log(JSON.stringify(lambda));
//console.log(JSON.stringify(E));
console.log(JSON.stringify(X));
		});

	</script>
</head>

<body>
</body>
</html>
