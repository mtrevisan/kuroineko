<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Mauro Trevisan">
	<link rel="shortcut icon" href="../favicon.png" />

	<title>test hypenator</title>

	<script src="../app/AMDLoader.js"></script>

	<script>
		AMDLoader.config = {
			baseUrl: '../app',
			paths: {
				libs: '../libs'
			}
		};

		/**
		 * @class Hypenator
		 *
		 * @see {@link https://github.com/mnater/Hyphenator/blob/master/Hyphenator.js}
		 *
		 * @author Mauro Trevisan

		Hyphenator.languages['it'] = {
			leftmin: 1,
			rightmin: 2,
			patterns: {
				2: '1b1c1d1f1g1h1j1k1l1m1n1p1q1r1t1v1w1x1z',
				3: '2’2e2w2bb2bc2bd2bf2bm2bn2bp2bs2bt2bvb2lb2r2b_2b’2cb2cc2cd2cf2ck2cm2cn2cq2cs2ct2czc2hc2lc2r2c_2c’_c22db2dd2dg2dl2dm2dn2dpd2r2ds2dt2dv2dw2d_2d’_d22fb2fg2ff2fnf2lf2r2fs2ft2f_2f’2gb2gd2gf2ggg2hg2l2gmg2n2gpg2r2gs2gt2gv2gw2gz2g_2g’2hb2hd2hhh2l2hm2hn2hr2hv2h_2h’2j_2j’2kg2kfk2h2kkk2l2kmk2r2ks2kt2k_2k’2lb2lc2ld2lgl2h2lk2ll2lm2ln2lp2lq2lr2ls2lt2lv2lw2lz2l_2mb2mc2mf2ml2mm2mn2mp2mq2mr2ms2mt2mv2mw2m_2m’2nb2nc2nd2nf2ng2nk2nl2nm2nn2np2nq2nr2ns2nt2nv2nz2n_2n’2pdp2hp2l2pn2ppp2r2ps2pt2pz2p_2p’2qq2q_2q’2rb2rc2rd2rfr2h2rg2rk2rl2rm2rn2rp2rq2rr2rs2rt2rv2rx2rw2rz2r_2r’1s22sz4s_2tb2tc2td2tf2tgt2ht2l2tm2tn2tpt2rt2s2tt2tv2twt2z2t_2vcv2lv2r2vv2v_w2h2w_2w’2xb2xc2xf2xh2xm2xp2xt2xw2x_2x’y1i2zb2zd2zl2zn2zp2zt2zs2zv2zz2z_',
				4: '_p2sa1iaa1iea1ioa1iua1uoa1ya2at_e1iuo1iao1ieo1ioo1iu2chh2chbch2r2chn2l’_2l’’2shm2sh_2sh’2s3s2stb2stc2std2stf2stg2stm2stn2stp2sts2stt2stv4s’_4s’’2tzktz2s2t’_2t’’2v’_2v’’wa2r2w1yy1ou2z’_2z’’_z2',
				5: '_bio1_pre12gh2t2l3f2n2g3n3p2nes4s3mt2t3s',
				6: '_a3p2n_anti1_free3_opto1_para1hi3p2n2nheit3p2sicr2t2s32s3p2n3t2sch',
				7: '_ca4p3s_e2x1eu_narco1_su2b3r_wa2g3n_wel2t1n2s3fer',
				8: '_contro1_fran2k3_li3p2sa_orto3p2_poli3p2_sha2re3_su2b3lu',
				9: '_anti3m2n_circu2m1_re1i2scr_tran2s3c_tran2s3d_tran2s3l_tran2s3n_tran2s3p_tran2s3r_tran2s3t',
				10: '_di2s3cine'
			}
		};

		 */
		require(['tools/data/ArrayHelper', 'tools/data/structs/Trie', 'tools/lang/phonology/Syllabator'], function(ArrayHelper, Trie, Syllabator){

			var cache = {},
				trie, trieData,
//				softHyphen = String.fromCharCode(173);
//				softHyphen = \u00AD;
				softHyphen = '-';

			var enableCache = true;
			var exceptions = {};
			//minimal length of characters before the first hyphenation
			var leftmin = 1;
			//minimal length of characters after the last hyphenation
			var rightmin = 0;


			var readPatterns = function(patterns){
				trie = new Trie();
				trieData = {};

				var cleanPattern;
				Object.keys(patterns).forEach(function(length){
					chunkString(patterns[length], length).forEach(function(pattern){
						cleanPattern = pattern.replace(/\d/g, '');
						trie.add(cleanPattern);
						trieData[cleanPattern] = pattern;
					});
				}, patterns);
			};

			/** @private */
			var chunkString = function(str, length){
				return str.match(new RegExp('.{' + length + '}', 'g'));
			};

			var hypenate = function(word){
				var hypenatedWord = '';
				if(word.indexOf(softHyphen) >= 0)
					//word already contains &shy; then leave as it is
					hypenatedWord = word;
				else if(enableCache && cache[word])
					//the word is in the cache
					hypenatedWord = cache[word];
				else if(exceptions && exceptions[word])
					//the word is in the exceptions list
					hypenatedWord = exceptions[word].replace(/-/g, softHyphen);
				else if(word.indexOf('-') >= 0)
					//if word contains '-' then hyphenate the parts separated with '-'
					hypenatedWord = word.split('-')
						.map(hypenate)
						.join('-');
				else{
					var ww = '.' + word.toLowerCase() + '.';
					if(String.prototype.normalize)
						ww = ww.normalize();
					if(ww.match(/[^-'‘’aàbcdđeéèfghiíjɉklƚmnñoóòprsʃtŧuúvxʒ.]/))
						return word;

					var size = ww.length,
						hyp = [],
						i, j,
						tmp;
					for(i = 0; i < size; i ++){
						tmp = ww.substring(i);
						trie.findPrefix(tmp).forEach(function(pref){
							j = -1;
							trieData[pref.node.prefix].split('').forEach(function(d){
								d = parseInt(d);
								if(isNaN(d))
									j ++;
								else if(!hyp[i + j] || d > hyp[i + j])
									hyp[i + j] = d;
							});
						});
					}

					//create hyphenated word
					var maxLength = word.length - rightmin;
					hypenatedWord = word.split('').map(function(chr, idx){
						return (idx >= leftmin && idx <= maxLength && this[idx] % 2? softHyphen: '') + chr;
					}, hyp).join('');

					if(enableCache)
						//put the word in the cache
						cache[word] = hypenatedWord;
				}

				return hypenatedWord;
			};

			/** @private */
			var syllabatePhonematicAndJoin = function(word){
				return Syllabator.syllabate(word, undefined, false).syllabes.join(softHyphen);
			};


			readPatterns({
				//aàbcdđeéèfghiíjɉklƚmnñoóòprstŧuúvx
				2: '1b1c1d1đ1f1g1j1ɉ1k1l1ƚ1m1n1ñ1p1r1t1ŧ1v1x',
				3: '1s21x2'
					+ '2bc2bd2bđ2bf2bg2bj2bɉ2bk2bl2bm2bn2bñ2bp2br2bs2bt2bŧ2bv2bx'
					+ '2b.2c.2d.2đ.2f.2g.2j.2ɉ.2k.2l.2ƚ.2m.2n.2ñ.2p.2r.4s.2t.2ŧ.2v.2x.'
					+ 'b2lb2r'
					+ 'c2lc2r'
					+ 'd2r'
					+ '2db2dc2dđ2df2dg2dj2dɉ2dk2dl2dm2dn2dñ2dp2dr2ds2dt2dŧ2dv2dx'
					+ 'g2kg2r'
					+ 'k2lk2r'
					+ '2lb2lc2ld2lđ2lg2lj2lɉ2lk2lm2ln2lñ2lp2lr2ls2lt2lŧ2lv2lx'
					+ '2mb2mc2md2mđ2mf2mg2mj2mɉ2mk2ml2mn2mñ2mp2mr2ms2mt2mŧ2mv2mx'
					+ '2nb2nc2nd2nđ2nf2ng2nj2nɉ2nk2nl2nm2nñ2np2nr2ns2nt2nŧ2nv2nx'
					+ 'p2lp2rp2x'
					+ '2rb2rc2rd2rđ2rf2rg2rj2rɉ2rk2rl2rm2rn2rñ2rp2rs2rt2rŧ2rv2rx'
					+ 't2đt2lt2rt2st2ŧt2x'
					+ '2tb2tc2td2tđ2tf2tg2tj2tɉ2tk2tl2tm2tn2tñ2tp2tr2ts2tŧ2tv2tx'
					+ '2xb2xd2xđ2xg2xj2xɉ2xl2xm2xn2xñ2xr2xs2xŧ2xv'
					//greek digrams
					+ 'b1mb1nb1s'
					+ 'k1mk1nk1s'
					//+ 'p1m2pn2ps'
					+ 't1nt1s'
					+ 'm1lm1r'
					+ 'n1ln1r'
					+ 'r1l',
//			.replace(/([jw])([lr])/g, replacement)
//			.replace(/([b])([dnt])/g, replacement);
				4: '1p2n.p2s'
					+ '.t3m',
				5: '2l3f2'
					+ 'n2g1s',
				6: '3p2sik',
				7: '.kà4p3s'

//				2: 'a1à1ò1è1o1ó1e1é1u1ú1i1í1',
//				3: 'ò2aò2àè2òè2aè2ào2ío2úo2eo2éo2èo2oo2óo2òo2ao2àe2íe2úe2ee2ée2oe2óe2èe2òe2ae2àé2oé2aé2àu2eu2éu2ou2óu2úu2èu2òu2au2àú2eú2oú2aú2iú2ui2ui2úi2ei2éi2oi2ói2úi2èi2òi2ai2àí2ií2uí2eí2oí2aa2ía2úa2ea2éa2oa2óa2èa2òa2aa2àà2aó2aà2eè2eé2eò2eó2eà2oè2oò2oó2o'
//					+ 'b1mk1mp1mt1mb1nk1np1nt1nb1sk1sp1st1s'
//					+ 'm1ln1lr1lj1lw1lm1rn1rr1rj1rw1r'
//					+ 'b1db1nb1t',
//				4: 'a2s.a2x.a2f.a2ŧ.a2v.a2đ.a2c.a2ɉ.a2j.a2p.a2b.a2k.a2g.a2t.a2d.a2m.a2n.a2l.a2r.a2i.a2í.a2u.a2ú.a2e.a2é.a2o.a2ò.a2è.a2ò.a2a.a2à.'
//					+ 'ò2s.ò2x.ò2f.ò2ŧ.ò2v.ò2đ.ò2c.ò2ɉ.ò2j.ò2p.ò2b.ò2k.ò2g.ò2t.ò2d.ò2m.ò2n.ò2l.ò2r.ò2i.ò2u.ò2e.ò2o.ò2a.'
//					+ 'è2s.è2x.è2f.è2ŧ.è2v.è2đ.è2c.è2ɉ.è2j.è2p.è2b.è2k.è2g.è2t.è2d.è2m.è2n.è2l.è2r.è2i.è2u.è2e.è2o.è2a.'
//					+ 'o2s.o2x.o2f.o2ŧ.o2v.o2đ.o2c.o2ɉ.o2j.o2p.o2b.o2k.o2g.o2t.o2d.o2m.o2n.o2l.o2r.o2i.o2í.o2u.o2ú.o2e.o2é.o2o.o2ò.o2è.o2ò.o2a.o2à.'
//					+ 'e2s.e2x.e2f.e2ŧ.e2v.e2đ.e2c.e2ɉ.e2j.e2p.e2b.e2k.e2g.e2t.e2d.e2m.e2n.e2l.e2r.e2i.e2í.e2u.e2ú.e2e.e2é.e2o.e2ò.e2è.e2ò.e2a.e2à.'
//					+ 'u2s.u2x.u2f.u2ŧ.u2v.u2đ.u2c.u2ɉ.u2j.u2p.u2b.u2k.u2g.u2t.u2d.u2m.u2n.u2l.u2r.u2i.u2í.u2u.u2ú.u2e.u2é.u2o.u2ò.u2è.u2ò.u2a.u2à.'
//					+ 'i2s.i2x.i2f.i2ŧ.i2v.i2đ.i2c.i2ɉ.i2j.i2p.i2b.i2k.i2g.i2t.i2d.i2m.i2n.i2l.i2r.i2i.i2í.i2u.i2ú.i2e.i2é.i2o.i2ò.i2è.i2ò.i2a.i2à.'
			});
			var words = ['kaxa', 'jutar', 'pàuxa', 'piaŧa', 'auguri', 'àuguri', 'poèta', 'paura', 'grant', 'inbrijar', 'autoirònego', 'aŧion', 'èrba', 'saltar', 'lontan', 'finlandia', 'abdegar', 'gronda', 'umlaut', 'injasar', 'àlbaro', 'serpente', 'kospirar', 'kosto', 'kostrénxer', 'despresar', 'bastanŧa', 'destrikar', 'peskar', 'maèstra', 'dexmentegà', 'ciklixmo', 'strako', 'scantixo', 'sfexa', 'stabia', 'stranbo', 'skòpo', 'stabia', 'xbaro', 'xbrigar', 'xbèrla', 'submontano', 'abnegasion', 'àbside', 'drakma', 'tèknika', 'iks', 'etnía', 'pnèumo', 'apnèa', 'ipnoxi', 'psiko', 'biopsía', 'kàpsula', 'tmèxi', 'ritmo', 'aritmètega', 'tungstèno', 'poexía'];
			words.forEach(function(word){
				var hypenatedWord = hypenate(word);
				var syllabatedWord = syllabatePhonematicAndJoin(word);

				console.log(hypenatedWord + ' / ' + syllabatedWord);
			});
		});
	</script>
</head>

<body>
</body>
</html>
